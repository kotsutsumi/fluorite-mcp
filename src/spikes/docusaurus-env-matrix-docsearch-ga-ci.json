{
  "id": "docusaurus-env-matrix-docsearch-ga-ci",
  "name": "Docusaurus 環境別キー切替 CI (DocSearch/GA) 最小",
  "version": "1.0.0",
  "stack": ["react", "docusaurus", "ci", "env", "secrets", "algolia", "analytics"],
  "tags": ["docs", "static-site", "env", "secrets", "ci", "preview", "production", "docusaurus"],
  "description": "Preview(PR)とProduction(main)で DocSearch/GA のキーをSecretsから自動切替してビルドする最小CIテンプレート。",
  "params": [
    { "name": "app_name", "default": "docusaurus-env-matrix" },
    { "name": "title", "default": "My Docusaurus Docs" },
    { "name": "url", "default": "https://<owner>.github.io" },
    { "name": "baseUrl", "default": "/<repo>/" },
    { "name": "org", "default": "owner" },
    { "name": "repo", "default": "repo" }
  ],
  "files": [
    { "path": "{{app_name}}/package.json", "template": "{\n  \"name\": \"{{app_name}}\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"docusaurus start\",\n    \"build\": \"docusaurus build\",\n    \"serve\": \"docusaurus serve\"\n  },\n  \"dependencies\": {\n    \"@docusaurus/core\": \"latest\",\n    \"@docusaurus/preset-classic\": \"latest\",\n    \"react\": \"^18.0.0\",\n    \"react-dom\": \"^18.0.0\"\n  }\n}\n" },
    { "path": "{{app_name}}/docusaurus.config.js", "template": "// @ts-check\n/** @type {import('@docusaurus/types').Config} */\nmodule.exports = {\n  title: '{{title}}',\n  url: '{{url}}',\n  baseUrl: '{{baseUrl}}',\n  favicon: 'img/favicon.ico',\n  organizationName: '{{org}}',\n  projectName: '{{repo}}',\n  themeConfig: {\n    gtag: { trackingID: process.env.GA_ID || '', anonymizeIP: true },\n    algolia: {\n      appId: process.env.ALGOLIA_APP_ID || '',\n      apiKey: process.env.ALGOLIA_API_KEY || '',\n      indexName: process.env.ALGOLIA_INDEX_NAME || ''\n    }\n  },\n  presets: [[ '@docusaurus/preset-classic', ({ docs: { sidebarPath: require.resolve('./sidebars.js') }, blog: false, sitemap: { changefreq: 'weekly', priority: 0.5, trailingSlash: false }, theme: { customCss: [] } }) ]]\n};\n" },
    { "path": "{{app_name}}/sidebars.js", "template": "// @ts-check\n/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */\nmodule.exports = { docs: [{ type: 'autogenerated', dirName: '.' }] };\n" },
    { "path": "{{app_name}}/docs/intro.md", "template": "---\nid: intro\nslug: /\ntitle: Introduction\n---\n\n# {{title}}\n\nPreview(PR) と Production(main) で DocSearch/GA のキーを自動切替するCI例です。\n`GA_ID_PREVIEW/PROD`, `ALGOLIA_*_PREVIEW/PROD` のSecretsを設定してください。\n" },
    { "path": "{{app_name}}/.github/workflows/deploy.yml", "template": "name: Deploy Docusaurus (Env Matrix)\n\non:\n  push:\n    branches: [ main ]\n  pull_request:\n    branches: [ main ]\n  workflow_dispatch: {}\n\npermissions:\n  contents: read\n  pages: write\n  id-token: write\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    env:\n      # Common (can be shared across envs)\n      ALGOLIA_APP_ID: ${{ secrets.ALGOLIA_APP_ID }}\n      # Switch by event (PR vs push)\n      GA_ID: ${{ github.event_name == 'pull_request' && secrets.GA_ID_PREVIEW || secrets.GA_ID_PROD }}\n      ALGOLIA_API_KEY: ${{ github.event_name == 'pull_request' && secrets.ALGOLIA_API_KEY_PREVIEW || secrets.ALGOLIA_API_KEY_PROD }}\n      ALGOLIA_INDEX_NAME: ${{ github.event_name == 'pull_request' && secrets.ALGOLIA_INDEX_NAME_PREVIEW || secrets.ALGOLIA_INDEX_NAME_PROD }}\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 20\n      - run: npm ci\n      - run: npm run build\n      - uses: actions/upload-pages-artifact@v3\n        with:\n          path: build\n  deploy:\n    needs: build\n    runs-on: ubuntu-latest\n    environment: ${{ github.event_name == 'pull_request' && 'github-pages-preview' || 'github-pages' }}\n    steps:\n      - id: deployment\n        uses: actions/deploy-pages@v4\n        with:\n          preview: ${{ github.event_name == 'pull_request' }}\n" }
  ]
}

