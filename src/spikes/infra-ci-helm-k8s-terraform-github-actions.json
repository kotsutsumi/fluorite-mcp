{
  "id": "infra-ci-helm-k8s-terraform-github-actions",
  "name": "Infra CI (Helm/K8s/Terraform) GitHub Actions 最小",
  "version": "1.0.0",
  "stack": ["helm", "kubernetes", "terraform", "ci"],
  "tags": ["infra", "ci", "helm", "k8s", "terraform"],
  "description": "Helm/K8s/Terraformのチェック/デプロイ手順を最小構成でまとめたCIワークフロー（dry-run中心）。",
  "files": [
    { "path": ".github/workflows/infra.yml", "template": "name: Infra CI (Helm/K8s/Terraform)\n\non: [push, workflow_dispatch]\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Terraform fmt/validate\n        run: |\n          cd terraform || exit 0\n          terraform fmt -check || true\n          terraform init -backend=false\n          terraform validate\n      - name: Helm lint\n        run: |\n          helm lint helm/chart || true\n      - name: K8s dry run (kubectl client-side)\n        run: |\n          kubectl apply --dry-run=client -f k8s/ || true\n  deploy:\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    needs: validate\n    steps:\n      - uses: actions/checkout@v4\n      - name: Helm upgrade (example)\n        run: |\n          helm upgrade --install myapp helm/chart --set image=nginx:alpine --namespace default --create-namespace || true\n      - name: K8s apply\n        run: |\n          kubectl apply -f k8s/ || true\n" }
  ]
}

