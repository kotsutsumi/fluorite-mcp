{
  "id": "nextjs-lottie-sw-workbox-minimal",
  "name": "Next.js Lottie Workbox SW 最小",
  "version": "1.0.0",
  "stack": ["nextjs", "react", "lottie", "pwa"],
  "tags": ["nextjs", "lottie", "workbox", "service-worker", "pwa"],
  "description": "WorkboxでLottie JSONをStale-While-Revalidateでキャッシュする最小例。",
  "params": [
    { "name": "lottie_url", "default": "https://assets9.lottiefiles.com/packages/lf20_5ngs2ksb.json" }
  ],
  "files": [
    { "path": "public/sw-wb.js", "template": "importScripts('https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js');\nif (self.workbox) {\n  const { registerRoute } = self.workbox.routing;\n  const { StaleWhileRevalidate } = self.workbox.strategies;\n  const match = new RegExp('^(' + {{'"'}}{{lottie_url}}{{'"'}}.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\$&') + ')');\n  registerRoute(({url}) => match.test(url.href), new StaleWhileRevalidate({ cacheName: 'lottie-json' }));\n}\n" },
    { "path": "app/sw-wb-register/page.tsx", "template": "'use client';\nimport React, { useEffect } from 'react';\nexport default function Page(){\n  useEffect(()=>{ if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw-wb.js'); } },[]);\n  return (<main style={{ fontFamily:'sans-serif', padding:24 }}><h1>Workbox SW Registered</h1></main>);\n}\n" },
    { "path": "app/lottie-sw-wb/page.tsx", "template": "'use client';\nimport React, { useEffect, useRef, useState } from 'react';\nimport Lottie, { LottieRefCurrentProps } from 'lottie-react';\nexport default function Page(){\n  const ref = useRef<LottieRefCurrentProps>(null);\n  const [data, setData] = useState<any|null>(null);\n  const url = process.env.NEXT_PUBLIC_LOTTIE_URL || '{{lottie_url}}';\n  useEffect(()=>{ let alive=true; fetch(url).then(r=>r.json()).then(j=>{ if(alive) setData(j); }); return ()=>{ alive=false; }; },[url]);\n  return (<main style={{ padding:24, fontFamily:'sans-serif' }}><h1>Lottie with Workbox SW</h1><div style={{ width:240, height:240, border:'1px solid #eee' }}>{data ? <Lottie lottieRef={ref} animationData={data} loop autoplay style={{ width:240, height:240 }} /> : 'Loading...'}</div></main>);\n}\n" }
  ]
}

