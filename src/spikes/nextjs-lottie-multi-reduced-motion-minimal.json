{
  "id": "nextjs-lottie-multi-reduced-motion-minimal",
  "name": "Next.js Lottie 複数/遅延/ReducedMotion 最小",
  "version": "1.0.0",
  "stack": ["nextjs", "react", "lottie"],
  "tags": ["nextjs", "app-router", "client", "lottie", "a11y", "reduced-motion"],
  "description": "複数のLottieを遅延ロードし、ユーザーのReduced Motion設定で自動再生を抑制する最小例。",
  "params": [
    { "name": "lottie_url1", "default": "https://assets9.lottiefiles.com/packages/lf20_5ngs2ksb.json" },
    { "name": "lottie_url2", "default": "https://assets9.lottiefiles.com/packages/lf20_q5qeoo3q.json" }
  ],
  "files": [
    {
      "path": "app/lottie-multi/page.tsx",
      "template": "'use client';\nimport React, { useEffect, useRef, useState } from 'react';\nimport Lottie, { LottieRefCurrentProps } from 'lottie-react';\n\nfunction useReducedMotion(){\n  const [reduced, setReduced] = useState(false);\n  useEffect(()=>{\n    const m = window.matchMedia('(prefers-reduced-motion: reduce)');\n    const on = () => setReduced(!!m.matches);\n    on();\n    m.addEventListener('change', on);\n    return () => m.removeEventListener('change', on);\n  },[]);\n  return reduced;\n}\n\nfunction LazyLottie({ url, width=240, height=240 }: { url: string; width?: number; height?: number }){\n  const [open, setOpen] = useState(false);\n  const [data, setData] = useState<any|null>(null);\n  const ref = useRef<LottieRefCurrentProps>(null);\n  const reduced = useReducedMotion();\n\n  useEffect(()=>{\n    if (!open) return;\n    let alive = true;\n    fetch(url).then(r=>r.json()).then(j=>{ if(alive) setData(j); });\n    return () => { alive = false; };\n  },[open, url]);\n\n  return (\n    <div style={{ border: '1px solid #ddd', padding: 12, borderRadius: 8 }}>\n      <button onClick={()=> setOpen(v=>!v)}>{open ? '折りたたむ' : '展開する'}</button>\n      {open && (\n        <div style={{ marginTop: 8, width, height, display:'flex',alignItems:'center',justifyContent:'center' }}>\n          {data ? (\n            <Lottie lottieRef={ref} animationData={data} loop autoplay={!reduced} style={{ width, height }} />\n          ) : 'Loading...'}\n        </div>\n      )}\n      {reduced && <p style={{ color: '#666', marginTop: 8 }}>※ Reduced Motion が有効のため自動再生を抑制しています。</p>}\n    </div>\n  );\n}\n\nexport default function Page(){\n  const url1 = process.env.NEXT_PUBLIC_LOTTIE_URL1 || '{{lottie_url1}}';\n  const url2 = process.env.NEXT_PUBLIC_LOTTIE_URL2 || '{{lottie_url2}}';\n  return (\n    <main style={{ fontFamily: 'sans-serif', padding: 24, display:'grid', gap: 16 }}>\n      <h1>Lottie Multi + Reduced Motion</h1>\n      <LazyLottie url={url1} />\n      <LazyLottie url={url2} />\n    </main>\n  );\n}\n"
    }
  ]
}

